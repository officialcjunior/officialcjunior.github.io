<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Reversing Nanomites | Aswin's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>home</a></li><li><a href=/projects/>projects</a></li><li><a href=/bookshelf/>bookshelf</a></li><li><a href=/tweets/>tweets</a></li><li><a href=/about/>about</a></li></ul><hr></nav><div class=article-meta><h2><span class=title>Reversing Nanomites</span></h2><h5 class=date>2020-06-08</h5></div><main><p>One particular challenge over there rootme.org taught me a couple of things and I thought it&rsquo;d be great to share some of them.</p><p>The challenge name is <strong>&lsquo;ELF x64 - Nanomites - Introduction&rsquo;</strong> and you can get it from <a href=https://www.root-me.org/en/Challenges/Cracking/ELF-x64-Nanomites-Introduction>here</a>. It just asks for an input, which is the flag.</p><p>Nanomites are programs where you have two processes: a father and a son. A parent and a child, if you will.</p><p>Let&rsquo;s try running it, now.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>➜ ./ch28.bin
Please input the flag:
flaggo
Wrong! try hard! :<span style=color:#f92672>)</span>
</code></pre></div><p>The function at <code>0x00400871</code> is where the real game begins and what&rsquo;s interesting here, is the call to <code>_fork()_</code>.</p><p>And if you don&rsquo;t know what fork does, now&rsquo;s a good time to look it up because that&rsquo;s the crux of the challenge. Particularly the return value, upon which the further program flow clearly depend. To put it gently, fork() creates two processes: the child and the parent.</p><p>Here&rsquo;s something from the manpage of fork:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>RETURN VALUE
       On success, the PID of the child process is returned in the parent, and <span style=color:#ae81ff>0</span> is returned in the child.  On failure, -1 is returned in the par‐
       ent, no child process is created, and errno is set appropriately.  
</code></pre></div><p>So, to put it clearly:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pid !<span style=color:#f92672>=</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
	instruction_for_child;
	<span style=color:#f92672>}</span>
<span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
	instruction_for_parent;
<span style=color:#f92672>}</span>
</code></pre></div><p>Which means, we&rsquo;ll need to tell the debugger which process to debug.</p><p>On radare2, you can do that by : <em>e dbg.follow.child=true</em> and on GDB, <em>set follow-fork-mode child</em></p><hr><p>Okay, so moving onto the challenge now: all the comparisons will fall into place if you&rsquo;re following the child and you&rsquo;ll find yourself the function at <code>fcn.00400736.</code></p><p>Just check out the comparisons over there :)</p></main><footer><script src=//yihui.org/js/math-code.js></script><script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script async src=//yihui.org/js/center-img.js></script><hr>Aswin&rsquo;s blog<br><a href=/index.xml>RSS Feed</a></footer></body></html>